<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>StoryTelling</title>
</head>
<script src="js/jquery-latest.min.js"></script>
<script src="js/d3.min.js" charset="utf-8"></script>
<body>
	<div id="map"></div>

	<script>
		var map=d3.select("#map");
		var h=800;
		var w=1400;
		var scale=1400;
		var svg=map.append("svg").attr("width", w).attr("height", h);
		var latm=0;
		var lonm=180;
		var color=d3.scale.category20c(); 
		d3.csv("data/stations.csv",function(station){
			for (var i = 0; i < station.length; i++) {
				// console.log(station[i].baidu_lat>max);
				if(station[i].baidu_lat>latm)
					latm=station[i].baidu_lat;
				if(station[i].baidu_lon<lonm)
					lonm=station[i].baidu_lon;
			}
			for (var i = 0; i < station.length; i++) {
				svg.append("circle").attr("cx",scale*(station[i].baidu_lon-lonm))
				.attr("cy",scale*(latm-station[i].baidu_lat)).attr("r",1);
				svg.append("text")
				.attr("x",scale*(station[i].baidu_lon-lonm))
				.attr("y",scale*(latm-station[i].baidu_lat))
				.attr("font-size",10)
				.text(station[i].station)
				.attr("fill","green");
			}
			d3.csv("data/shmetro_paths.csv",function(line){
				console.log(line[2]);
				for (var i = 0; i < line.length; i++) {
					var start=selectLine(station,line[i].line,line[i].line_id_start);
					var to=selectLine(station,line[i].line,line[i].line_id_to);
					if(start==null||to==null)
						continue;
					svg.append("line").attr("stroke",color(line[i].line))
					.attr("x1",scale*(start.baidu_lon-lonm)).attr("y1",scale*(latm-start.baidu_lat))
					.attr("x2",scale*(to.baidu_lon-lonm)).attr("y2",scale*(latm-to.baidu_lat));
				}
			})
		});
		function selectLine(stations,line,id){
			for (var i = 0; i < stations.length; i++) {
				if(stations[i].line==line&&stations[i].line_id==id){
					return stations[i];
				}
			}
		}
	</script>
</body>
</html>